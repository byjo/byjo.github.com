---
layout: post
title: "트랜잭션"
description: ""
category: "DB" 
tags: [DB]
---
## 트랜잭션 병렬 처리 -인터리빙(interleaving) 형태의 동시성 관점에서-
###### 인터리빙 
CPU 사용률을 높이기 위해, io 대기가 발생할 경우 다른 프로세스의 작업을 수행

## 기본 db접근 연산
- read_item(X)
    1. X를 포함하는 디스크 블록의 주소를 찾는다 
    2. 디스크블록을 메모리에 복사한다 
    3. 항목 X를 버퍼로부터 프로그램 변수 X로 복사한다 
- write_item(X)
    1. X를 포함하는 디스크 블록의 주소를 찾는다 
    2. 디스크블록을 메모리에 복사한다 
    3. 프로그램 변수 X를 항목 X가 위치한 버퍼로 복사한다
    4. 갱신된 블록을 디스크에 저장한다 
- 모든 트랜잭션은 read_item과 write_item의 연산으로 구성되어 있다 

## 트랜잭션의 정보 및 상태
#### 트랜잭션 정보 
- 트랜잭션 시작 
- 읽기/쓰기 
- 트랜잭션 종료 : 연산의 종료. 트랜잭션으로 인한 변화의 반영 혹은 철회를 할지 확인해야 한다 
- 트랜잭션 완료(commit) : 트랜잭션의 성공적인 종료. 트랜잭션으로 갱신된 사항이 모두 DB에 저장되었다
- 복귀(rollback) : 트랜잭션의 실패. 트랜잭션으로 갱신된 사항은 모두 취소된다

#### 트랜잭션 상태 
- Active : 트랜잭션의 실행 직후 수행중인 상태
- Partially Committed : 트랜잭션 종료 상태 
- Committed : 트랜잭션 완료 상태 
- Failed : 트랜잭션 실패 
- Aborted : 트랜잭션이 시스템을 떠나는 상태, 트랜잭션 정보가 사라짐 

## 트랜잭션 병렬화의 목적
1. 트랜잭션 처리율을 높여, CPU 사용률과 disk utilization을 증가한다 
2. 트랜잭션의 평균 응답 속도를 높인다 

## 직렬 가능성
#### serial schedule 
하나의 트랜잭션이 모두 종료된 후에 다음 트랜잭션이 수행되도록 연산의 순서가 정해진 스케줄  
: 일관성 유지 

#### serializable schedule
한 스케줄이 serial 스케줄(하나의 트랜잭션 내 연산이 모두 수행된 후 다음 트랜잭션의 연산을 수행)과 동치이면, 그 스케줄은 serializable하다  
: 동치의 조건?

## 회복 가능성 
#### conflict
하나의 스케줄에 포함된 두 개의 연산이 다음 조건을 만족한다
    1. 서로 다른 트랜잭션에 속한다 
    2. 동일한 항목 X에 접근한다 
    3. 두 연산 중 최소 하나는 write_item(X)이다 
    : 직관적으로 두 연산의 순서를 바꿨을 때 다른 결과가 발생하면, 충돌한다

#### complete schedule
n개의 트랜잭션 T_1, T_2, ... ,T_n에 대한 스케줄 S가 다음을 만족한다 
    1. S내 연산은 T_i 내의 연산, 각 트랜잭션의 마지막 연산으로 완료/철회 연산을 포함한다 
    2. T_i내 연산의 어떠한 쌍에 대해서도, S안에서 연산들이 나타나는 상대적인 순서는 T_i에서와 동일하다 
    3. 충돌하는 두 개의 연산에 대해, 하나는 나머지 하나보다 스케줄에서 먼저 나타난다 

#### recoverable schedule
스케줄 S 내의 트랜잭션 T가 항목 X를 읽는 연산이 있다면, X에 쓰기 연산을 수행하는 트랜잭션 T'가 완료(commit)되기 전까지 T는 완료되지 않는다  
: 완료된 트랜잭션은 복귀할 필요가 없음을 보장(지속성 보장)   

#### cascading schedule
- cascading : 하나의 트랜잭션 실패가 여러 트랜잭션 철회(rollback)를 발생시킨다
: 여러 트랜잭션의 철회는 많은 시간을 소비하므로, 이런 상황이 발생하지 않도록 보장해야한다  
- cascading schedule : 스케줄 내의 모든 트랜잭션은 완료(commit)된 트랜잭션이 갱신한 항목만을 읽는다. 즉, 항목 X를 읽는 트랜잭션 T의 연산은, 항목 X에 쓰기 연산을 하는 트랜잭션 T’가 연산을 수행하고 완료(commit)된 이후에 수행된다.


  
